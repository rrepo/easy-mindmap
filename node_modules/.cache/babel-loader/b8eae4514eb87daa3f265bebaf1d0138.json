{"ast":null,"code":"import { onMounted, ref } from \"vue\";\nimport { dragscroll } from 'vue-dragscroll';\nexport default {\n  name: 'MindMap',\n  props: {},\n  directives: {\n    dragscroll\n  },\n\n  setup() {\n    let title = ref(\"title\");\n    let nodes = ref([{\n      \"id\": 0,\n      'text': 'ch0',\n      'url': '',\n      'parent': 'title',\n      'direction': ''\n    }, {\n      \"id\": 1,\n      'text': 'ch1',\n      'url': '',\n      'parent': 'title',\n      'direction': ''\n    }, {\n      \"id\": 2,\n      'text': 'ch2',\n      'url': '',\n      'parent': 0,\n      'direction': ''\n    }, {\n      \"id\": 3,\n      'text': 'ch3',\n      'url': '',\n      'parent': 0,\n      'direction': ''\n    }, {\n      \"id\": 4,\n      'text': 'ch4',\n      'url': '',\n      'parent': 1,\n      'direction': ''\n    }, {\n      \"id\": 5,\n      'text': 'ch5',\n      'url': '',\n      'parent': 1,\n      'direction': ''\n    }, {\n      \"id\": 6,\n      'text': 'ch6',\n      'url': '',\n      'parent': 'title',\n      'direction': ''\n    }, {\n      \"id\": 7,\n      'text': 'ch7',\n      'url': '',\n      'parent': 'title',\n      'direction': ''\n    }, {\n      \"id\": 8,\n      'text': 'ch8',\n      'url': '',\n      'parent': '2',\n      'direction': ''\n    }, {\n      \"id\": 9,\n      'text': 'ch9',\n      'url': '',\n      'parent': '2',\n      'direction': ''\n    }, {\n      \"id\": 10,\n      'text': 'ch10',\n      'url': '',\n      'parent': '4',\n      'direction': ''\n    }, {\n      \"id\": 11,\n      'text': 'ch11',\n      'url': '',\n      'parent': '4',\n      'direction': ''\n    }, {\n      \"id\": 12,\n      'text': 'ch12',\n      'url': '',\n      'parent': '5',\n      'direction': ''\n    }]);\n    let lines = ref([]);\n    let count = 0;\n    let focus;\n    const LeaderLine = window.LeaderLine;\n\n    const makeFromParent = (d, el, node_text, rap_node, node_childes, text) => {\n      node_text.classList.add(\"p_nodes\");\n      rap_node.classList.add(\"rap_node\"); // node_childes.classList.add(\"node_childes\");\n\n      node_childes.id = `${el[\"id\"]}`;\n      node_text.id = `${\"node\" + el[\"id\"]}`;\n      node_text.appendChild(text);\n      count++;\n      return [rap_node, node_text, node_childes];\n    };\n\n    const makeFromChild = (el, node_text, rap_node, node_childes, text) => {\n      // console.log(\"child\", el)\n      // console.log(el)\n      // console.log(el[\"parent\"])\n      const parent = document.getElementById(`${el[\"parent\"]}`);\n      node_text.classList.add(\"c_nodes\");\n      node_childes.id = `${el[\"id\"]}`;\n      node_text.id = `${\"node\" + el[\"id\"]}`; // node_childes.classList.add(\"node_childes\");\n\n      node_text.appendChild(text);\n      rap_node.appendChild(node_childes);\n      rap_node.appendChild(node_text);\n      parent.appendChild(rap_node); // console.log(nodes.value[el.parent].direction)\n\n      el.direction = nodes.value[el.parent].direction;\n\n      if (el.direction == 'right') {\n        rap_node.appendChild(node_text);\n        rap_node.appendChild(node_childes);\n        parent.appendChild(rap_node);\n        rap_node.classList.add(\"rap_node\");\n      } else {\n        rap_node.appendChild(node_childes);\n        rap_node.appendChild(node_text);\n        parent.appendChild(rap_node);\n        rap_node.classList.add(\"rap_node_left\");\n      }\n    };\n\n    const makeline = (el, direction, parent) => {\n      let line = new LeaderLine(document.getElementById(parent), LeaderLine.pointAnchor(document.getElementById(`${\"node\" + el[\"id\"]}`), {\n        x: `${direction + \"%\"}`,\n        y: '50%'\n      }));\n      line.path = \"magnet\";\n      line.endPlug = \"behind\";\n      lines.value.push(line);\n    };\n\n    const makelines = () => {\n      const right = 1;\n      const left = 99;\n      nodes.value.forEach(el => {\n        if (el.parent == 'title') {\n          if (el.direction == \"right\") {\n            makeline(el, right, 'title');\n          } else {\n            makeline(el, left, 'title');\n          }\n        } else {\n          if (el.direction == \"right\") {\n            makeline(el, right, `${\"node\" + el[\"parent\"]}`);\n          } else {\n            makeline(el, left, `${\"node\" + el[\"parent\"]}`);\n          }\n        }\n      });\n    };\n\n    const removelines = () => {\n      lines.value.forEach(el => {\n        el.remove();\n      });\n      lines.value.length = 0;\n    };\n\n    const line_reset = () => {\n      removelines();\n      makelines();\n    };\n\n    const keydown_title = e => {\n      // console.log(e.srcElement.innerText)\n      // title.value = e.srcElement.innerText\n      console.log(title, e);\n      line_reset();\n    };\n\n    const click_title_selector = e => {\n      // console.log(e.srcElement,\"click\")\n      focus_node(e.srcElement);\n    };\n\n    const focus_node = e => {\n      // console.log('focus',e)\n      e.classList.add(\"selector_focus\");\n      focus = e;\n      console.log(focus);\n    };\n\n    const dbclick_title_selector = e => {\n      console.log(\"dbclick_title_selector\");\n      console.log(e.srcElement.innerText);\n      document.getElementById(\"title\").focus();\n      document.getElementById(\"title\");\n      let obj = document.querySelector('#title');\n      const range = document.createRange(); // 新しい Rangeオブジェクト\n\n      const offset = obj.innerText.length; // 今回は行末に移動したいので文字長を取得\n\n      console.log(offset);\n      range.setStart(obj.firstChild, offset); // キャレットの開始位置を設定\n\n      range.setEnd(obj.firstChild, offset); // キャレットの終了位置を設定\n\n      const selection = window.getSelection();\n      selection.removeAllRanges(); // 現在のrangeをクリア\n\n      selection.addRange(range); // rangeを追加\n    };\n\n    const input_title = e => {\n      console.log(e.srcElement.innerText);\n      title.value = e.srcElement.innerText; // console.log(title)\n\n      line_reset();\n    };\n\n    const keydown_node = e => {\n      // console.log('keydown')\n      if (e.key === \"Tab\") {\n        e.preventDefault(); // console.log(e.target.id)\n        // console.log(e.srcElement)\n\n        let id = Number(e.srcElement.id.replace(\"node\", \"\"));\n        let new_node = {\n          \"id\": nodes.value.length,\n          'text': '',\n          'url': '',\n          'parent': id,\n          'direction': nodes.value[id].direction\n        };\n        nodes.value.push(new_node);\n        const node_text = document.createElement(\"div\");\n        const rap_node = document.createElement(\"div\");\n        const node_childes = document.createElement(\"div\");\n        const text = document.createTextNode('ch' + new_node.id);\n        node_text.contentEditable = true;\n        makeFromChild(nodes.value[new_node.id], node_text, rap_node, node_childes, text);\n        document.getElementById(`${'node' + new_node['id']}`).addEventListener('keydown', keydown_node);\n        document.getElementById(`${'node' + new_node['id']}`).addEventListener('keyup', keyup_node);\n        document.getElementById(`${'node' + new_node['id']}`).focus();\n      }\n\n      line_reset();\n    };\n\n    const keyup_node = e => {\n      // console.log('keyup')\n      if (e.key === \"Tab\") {\n        e.preventDefault(); // console.log(e.key)\n      }\n\n      let id = Number(e.srcElement.id.replace(\"node\", \"\"));\n      nodes.value[id].text = e.srcElement.innerText; // console.log(nodes.value[id].text)\n\n      line_reset();\n    };\n\n    onMounted(() => {\n      console.log(\"mounted\");\n      document.getElementById('title').scrollIntoView({\n        block: 'center',\n        inline: 'center'\n      });\n      const right = document.getElementById(\"right_center\");\n      const left = document.getElementById(\"left_center\");\n      nodes.value.forEach(el => {\n        const node_text = document.createElement(\"div\");\n        const rap_node = document.createElement(\"div\");\n        const node_childes = document.createElement(\"div\");\n        const text = document.createTextNode(el[\"text\"]);\n        node_text.contentEditable = true;\n\n        if (el[\"parent\"] == 'title') {\n          console.log();\n\n          if (count % 2 == 0) {\n            let nodeFromParent = makeFromParent(right, el, node_text, rap_node, node_childes, text);\n            nodeFromParent[0].appendChild(nodeFromParent[1]);\n            nodeFromParent[0].appendChild(nodeFromParent[2]);\n            right.appendChild(nodeFromParent[0]);\n            el.direction = 'right';\n          } else {\n            let nodeFromParent = makeFromParent(right, el, node_text, rap_node, node_childes, text);\n            nodeFromParent[0].appendChild(nodeFromParent[2]);\n            nodeFromParent[0].appendChild(nodeFromParent[1]);\n            left.appendChild(nodeFromParent[0]);\n            node_childes.classList.add(\"margin-auto\");\n            el.direction = 'left';\n          }\n        } else {\n          makeFromChild(el, node_text, rap_node, node_childes, text);\n        } // console.log(document.getElementById(`${'node' + el['id']}`))\n\n\n        document.getElementById(`${'node' + el['id']}`).addEventListener('keydown', keydown_node);\n        document.getElementById(`${'node' + el['id']}`).addEventListener('keyup', keyup_node);\n      });\n      console.log(nodes.value);\n      makelines();\n    });\n    return {\n      title,\n      nodes,\n      lines,\n      line_reset,\n      click_title_selector,\n      dbclick_title_selector,\n      input_title,\n      keydown_title,\n      keydown_node,\n      keyup_node\n    };\n  }\n\n};","map":{"version":3,"mappings":"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","names":["onMounted","ref","dragscroll","name","props","directives","setup","title","nodes","lines","count","focus","LeaderLine","window","makeFromParent","d","el","node_text","rap_node","node_childes","text","classList","add","id","appendChild","makeFromChild","parent","document","getElementById","direction","value","makeline","line","pointAnchor","x","y","path","endPlug","push","makelines","right","left","forEach","removelines","remove","length","line_reset","keydown_title","e","console","log","click_title_selector","focus_node","srcElement","dbclick_title_selector","innerText","obj","querySelector","range","createRange","offset","setStart","firstChild","setEnd","selection","getSelection","removeAllRanges","addRange","input_title","keydown_node","key","preventDefault","Number","replace","new_node","createElement","createTextNode","contentEditable","addEventListener","keyup_node","scrollIntoView","block","inline","nodeFromParent"],"sourceRoot":"","sources":["C:\\Users\\tnazu\\OneDrive\\ドキュメント\\coding\\vue3\\mindmap\\src\\components\\MindMap.vue"],"sourcesContent":["<template>\n  <div class=\"\">\n    <div class=\"edge\" @scroll=\"line_reset\" v-dragscroll=\"true\">\n      <div class=\"field\" id=\"field\">\n        <!-- <button class=\"btn\" @click=\"click()\">center</button> -->\n        <div class=\"left\">\n          <div class=\"left_vertical\">\n            <div class=\"left_horizontal\" id=\"left_center\">\n              <div></div>\n            </div>\n          </div>\n        </div>\n\n        <div class=\"center\">\n          <div class=\"title_node_rap\">\n            <div class=\"title_selector\" v-on:click=\"click_title_selector($event)\"\n              v-on:dblclick=\"dbclick_title_selector($event)\">\n              <div class=\"title_nodes\" id=\"title\" contenteditable=\"true\" @:keydown=\"input_title($event)\">\n                <!-- @:keydown.tab=\"push_tab($el)\" -->\n                {{ title }}\n              </div>\n            </div>\n\n          </div>\n\n        </div>\n\n        <div class=\"right\">\n          <div class=\"right_vertical\">\n            <div class=\"right_horizontal\" id=\"right_center\">\n              <div></div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport {\n  onMounted,\n  ref,\n\n} from \"vue\"\nimport { dragscroll } from 'vue-dragscroll'\n\nexport default {\n  name: 'MindMap',\n  props: {\n  },\n  directives: {\n    dragscroll\n  },\n  setup() {\n    let title = ref(\"title\")\n    let nodes = ref([\n      {\n        \"id\": 0,\n        'text': 'ch0',\n        'url': '',\n        'parent': 'title',\n        'direction': ''\n      },\n      {\n        \"id\": 1,\n        'text': 'ch1',\n        'url': '',\n        'parent': 'title',\n        'direction': ''\n      },\n      {\n        \"id\": 2,\n        'text': 'ch2',\n        'url': '',\n        'parent': 0,\n        'direction': ''\n      },\n      {\n        \"id\": 3,\n        'text': 'ch3',\n        'url': '',\n        'parent': 0,\n        'direction': ''\n      },\n      {\n        \"id\": 4,\n        'text': 'ch4',\n        'url': '',\n        'parent': 1,\n        'direction': ''\n      },\n      {\n        \"id\": 5,\n        'text': 'ch5',\n        'url': '',\n        'parent': 1,\n        'direction': ''\n      },\n      {\n        \"id\": 6,\n        'text': 'ch6',\n        'url': '',\n        'parent': 'title',\n        'direction': ''\n      },\n      {\n        \"id\": 7,\n        'text': 'ch7',\n        'url': '',\n        'parent': 'title',\n        'direction': ''\n      },\n      {\n        \"id\": 8,\n        'text': 'ch8',\n        'url': '',\n        'parent': '2',\n        'direction': ''\n      },\n      {\n        \"id\": 9,\n        'text': 'ch9',\n        'url': '',\n        'parent': '2',\n        'direction': ''\n      },\n      {\n        \"id\": 10,\n        'text': 'ch10',\n        'url': '',\n        'parent': '4',\n        'direction': ''\n      },\n      {\n        \"id\": 11,\n        'text': 'ch11',\n        'url': '',\n        'parent': '4',\n        'direction': ''\n      },\n      {\n        \"id\": 12,\n        'text': 'ch12',\n        'url': '',\n        'parent': '5',\n        'direction': ''\n      },\n    ]);\n    let lines = ref([\n\n    ])\n    let count = 0\n    let focus\n    const LeaderLine = window.LeaderLine;\n\n    const makeFromParent = (d, el, node_text, rap_node, node_childes, text) => {\n      node_text.classList.add(\"p_nodes\");\n      rap_node.classList.add(\"rap_node\");\n      // node_childes.classList.add(\"node_childes\");\n      node_childes.id = `${el[\"id\"]}`\n      node_text.id = `${\"node\" + el[\"id\"]}`\n      node_text.appendChild(text)\n\n      count++\n\n      return [rap_node, node_text, node_childes]\n    }\n\n    const makeFromChild = (el, node_text, rap_node, node_childes, text) => {\n      // console.log(\"child\", el)\n      // console.log(el)\n      // console.log(el[\"parent\"])\n\n      const parent = document.getElementById(`${el[\"parent\"]}`)\n      node_text.classList.add(\"c_nodes\");\n      node_childes.id = `${el[\"id\"]}`\n      node_text.id = `${\"node\" + el[\"id\"]}`\n      // node_childes.classList.add(\"node_childes\");\n      node_text.appendChild(text)\n      rap_node.appendChild(node_childes)\n      rap_node.appendChild(node_text)\n      parent.appendChild(rap_node)\n\n      // console.log(nodes.value[el.parent].direction)\n      el.direction = nodes.value[el.parent].direction\n      if (el.direction == 'right') {\n        rap_node.appendChild(node_text)\n        rap_node.appendChild(node_childes)\n        parent.appendChild(rap_node)\n        rap_node.classList.add(\"rap_node\");\n      } else {\n        rap_node.appendChild(node_childes)\n        rap_node.appendChild(node_text)\n        parent.appendChild(rap_node)\n        rap_node.classList.add(\"rap_node_left\");\n      }\n    }\n\n    const makeline = (el, direction, parent) => {\n      let line = new LeaderLine(\n        document.getElementById(parent),\n        LeaderLine.pointAnchor(document.getElementById(`${\"node\" + el[\"id\"]}`), { x: `${direction + \"%\"}`, y: '50%' })\n      );\n      line.path = \"magnet\"\n      line.endPlug = \"behind\"\n      lines.value.push(line)\n    }\n\n    const makelines = () => {\n      const right = 1\n      const left = 99\n\n      nodes.value.forEach(el => {\n        if (el.parent == 'title') {\n          if (el.direction == \"right\") {\n            makeline(el, right, 'title')\n          } else {\n            makeline(el, left, 'title')\n          }\n        } else {\n          if (el.direction == \"right\") {\n            makeline(el, right, `${\"node\" + el[\"parent\"]}`)\n          } else {\n            makeline(el, left, `${\"node\" + el[\"parent\"]}`)\n          }\n\n        }\n      })\n    }\n\n    const removelines = () => {\n      lines.value.forEach(el => {\n        el.remove()\n      })\n      lines.value.length = 0\n    }\n\n    const line_reset = () => {\n      removelines()\n      makelines()\n    }\n\n    const keydown_title = (e) => {\n      // console.log(e.srcElement.innerText)\n      // title.value = e.srcElement.innerText\n      console.log(title, e)\n      line_reset()\n    }\n\n    const click_title_selector = (e) => {\n      // console.log(e.srcElement,\"click\")\n\n      focus_node(e.srcElement)\n    }\n\n    const focus_node = (e) => {\n      // console.log('focus',e)\n      e.classList.add(\"selector_focus\");\n      focus = e\n      console.log(focus)\n    }\n\n    const dbclick_title_selector = (e) => {\n      console.log(\"dbclick_title_selector\")\n      console.log(e.srcElement.innerText)\n\n      document.getElementById(\"title\").focus();\n      document.getElementById(\"title\")\n\n      let obj = document.querySelector('#title')\n      const range = document.createRange() // 新しい Rangeオブジェクト\n      const offset = obj.innerText.length // 今回は行末に移動したいので文字長を取得\n      console.log(offset)\n      range.setStart(obj.firstChild, offset) // キャレットの開始位置を設定\n      range.setEnd(obj.firstChild, offset) // キャレットの終了位置を設定\n      const selection = window.getSelection()\n      selection.removeAllRanges() // 現在のrangeをクリア\n      selection.addRange(range) // rangeを追加\n    }\n\n    const input_title = (e) => {\n      console.log(e.srcElement.innerText)\n      title.value = e.srcElement.innerText\n      // console.log(title)\n      line_reset()\n    }\n\n    const keydown_node = (e) => {\n      // console.log('keydown')\n      if (e.key === \"Tab\") {\n        e.preventDefault();\n        // console.log(e.target.id)\n        // console.log(e.srcElement)\n        let id = Number(e.srcElement.id.replace(\"node\", \"\"))\n        let new_node = {\n          \"id\": nodes.value.length,\n          'text': '',\n          'url': '',\n          'parent': id,\n          'direction': nodes.value[id].direction\n        }\n        nodes.value.push(new_node)\n\n        const node_text = document.createElement(\"div\");\n        const rap_node = document.createElement(\"div\");\n        const node_childes = document.createElement(\"div\");\n        const text = document.createTextNode('ch' + new_node.id);\n        node_text.contentEditable = true;\n        makeFromChild(nodes.value[new_node.id], node_text, rap_node, node_childes, text)\n        document.getElementById(`${'node' + new_node['id']}`).addEventListener('keydown', keydown_node);\n        document.getElementById(`${'node' + new_node['id']}`).addEventListener('keyup', keyup_node);\n        document.getElementById(`${'node' + new_node['id']}`).focus();\n      }\n      line_reset()\n    }\n\n    const keyup_node = (e) => {\n      // console.log('keyup')\n      if (e.key === \"Tab\") {\n        e.preventDefault();\n        // console.log(e.key)\n      }\n\n\n      let id = Number(e.srcElement.id.replace(\"node\", \"\"))\n      nodes.value[id].text = e.srcElement.innerText\n      // console.log(nodes.value[id].text)\n\n      line_reset()\n    }\n\n    onMounted(() => {\n      console.log(\"mounted\")\n\n      document.getElementById('title').scrollIntoView({ block: 'center', inline: 'center', })\n\n      const right = document.getElementById(\"right_center\");\n      const left = document.getElementById(\"left_center\");\n\n      nodes.value.forEach(el => {\n        const node_text = document.createElement(\"div\");\n        const rap_node = document.createElement(\"div\");\n        const node_childes = document.createElement(\"div\");\n        const text = document.createTextNode(el[\"text\"]);\n        node_text.contentEditable = true;\n\n        if (el[\"parent\"] == 'title') {\n          console.log()\n          if (count % 2 == 0) {\n            let nodeFromParent = makeFromParent(right, el, node_text, rap_node, node_childes, text)\n\n            nodeFromParent[0].appendChild(nodeFromParent[1])\n            nodeFromParent[0].appendChild(nodeFromParent[2])\n\n            right.appendChild(nodeFromParent[0])\n            el.direction = 'right'\n          } else {\n            let nodeFromParent = makeFromParent(right, el, node_text, rap_node, node_childes, text)\n\n            nodeFromParent[0].appendChild(nodeFromParent[2])\n            nodeFromParent[0].appendChild(nodeFromParent[1])\n\n            left.appendChild(nodeFromParent[0])\n            node_childes.classList.add(\"margin-auto\")\n            el.direction = 'left'\n          }\n        } else {\n          makeFromChild(el, node_text, rap_node, node_childes, text)\n        }\n\n        // console.log(document.getElementById(`${'node' + el['id']}`))\n        document.getElementById(`${'node' + el['id']}`).addEventListener('keydown', keydown_node);\n        document.getElementById(`${'node' + el['id']}`).addEventListener('keyup', keyup_node);\n      });\n\n      console.log(nodes.value)\n\n      makelines()\n    });\n\n    return {\n      title,\n      nodes,\n      lines,\n      line_reset,\n\n      click_title_selector,\n      dbclick_title_selector,\n      input_title,\n      keydown_title,\n\n      keydown_node,\n      keyup_node,\n    };\n\n  },\n}\n</script>\n\n<!-- Add \"scoped\" attribute to limit CSS to this component only -->\n<style>\n.btn {\n  z-index: 10000;\n  /* display: flex; */\n}\n\n.edge {\n  width: 900px;\n  height: 900px;\n  overflow: hidden;\n  border: 1px solid #000;\n}\n\n.field {\n  width: 5000px;\n  height: 5000px;\n  /* z-index: 1; */\n  display: flex;\n  position: relative;\n}\n\n.center {\n  width: 10%;\n  height: 100%;\n  /* z-index: 1; */\n  /* background-color: coral; */\n}\n\n.right {\n  width: 45%;\n  height: 100%;\n  display: flex;\n  align-items: center;\n}\n\n.right_vertical {\n  width: 100%;\n  /* background-color: olive; */\n  margin: 0 auto;\n  display: flex;\n  justify-content: flex-start;\n}\n\n.right_horizontal {\n  width: fit-content;\n  /* background-color: orchid; */\n}\n\n.left {\n  width: 45%;\n  height: 100%;\n  display: flex;\n  align-items: center;\n}\n\n.left_vertical {\n  width: 100%;\n  margin: 0 auto;\n  text-align: left;\n  display: flex;\n  justify-content: flex-end;\n  /* background-color: olive; */\n}\n\n.left_horizontal {\n  width: fit-content;\n  /* background-color: orchid; */\n}\n\n.title_node_rap {\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  width: 100%;\n  height: 100%;\n  z-index: 2;\n}\n\n.title_selector {\n  width: fit-content;\n  height: fit-content;\n  border-radius: 10px;\n  /* width: 100px;\n  height: 100px; */\n  /* border: 4px solid; */\n\n  /* background-color: antiquewhite; */\n  position: relative;\n}\n\n.selector_focus {\n  border: 4px solid #00aaff;\n  border-radius: 10px;\n}\n\n\n.title_nodes {\n  border-radius: 10px;\n  box-shadow: 0 3px 3px 0 rgba(0, 0, 0, .5);\n  width: fit-content;\n  font-size: 35px;\n  font-family: sans-serif;\n  padding: 10px 10px;\n  background-color: #F5F5F5;\n  max-width: 200px;\n\n  /* pointer-events: none; */\n  position: relative;\n  z-index: -10\n}\n\n.title_nodes:focus {\n  outline: none;\n}\n\n.p_nodes {\n  background-color: #F5F5F5;\n  border-radius: 10px;\n  box-shadow: 0 3px 3px 0 rgba(0, 0, 0, .5);\n  /* width: fit-content;\n  height: fit-content; */\n  width: -moz-fit-content;\n  /* Firefox */\n  width: fit-content;\n  /* other browsers */\n  font-size: 23px;\n  padding: 10px 10px;\n  font-family: sans-serif;\n  margin: auto 0\n}\n\n.c_nodes {\n  background-color: #F5F5F5;\n  border-radius: 10px;\n  box-shadow: 0 3px 3px 0 rgba(0, 0, 0, .5);\n  /* width: fit-content;\n  height: fit-content; */\n  width: -moz-fit-content;\n  width: fit-content;\n  font-size: 23px;\n  padding: 10px 10px;\n  font-family: sans-serif;\n  margin: 30px 30px;\n}\n\n.rap_node {\n  display: flex;\n  align-items: center;\n  width: 100%;\n  /* height: 100%; */\n}\n\n.rap_node_left {\n  display: flex;\n  justify-content: flex-end;\n  align-items: center;\n  width: 100%;\n  /* height: 100%; */\n  /* background-color: yellow; */\n\n}\n\n.node_childes {\n  /* width: 100%;\n  height: 100%; */\n  /* background-color: brown; */\n}\n\n.right_node_childes {\n  width: 100%;\n  height: 100%;\n  background-color: brown;\n  width: -moz-fit-content;\n  /* Firefox */\n  width: fit-content;\n  /* other browsers */\n}\n\n.left_node_childes {\n  width: 100%;\n  height: 100%;\n  width: -moz-fit-content;\n  width: fit-content;\n  margin-right: auto;\n  background-color: forestgreen;\n}\n\n.margin-auto {\n  margin: auto;\n}\n\n#line {\n  position: absolute;\n  left: 100px;\n  top: 100px;\n  width: 200px;\n  height: 1px;\n  background-color: red;\n  transform-origin: left top;\n  transform: skewY(45deg);\n}\n</style>\n  \n"]},"metadata":{},"sourceType":"module"}