{"ast":null,"code":"import { onMounted, ref } from \"vue\";\nimport { dragscroll } from 'vue-dragscroll';\nexport default {\n  name: 'MindMap',\n  props: ['title_props', 'node_props'],\n  directives: {\n    dragscroll\n  },\n\n  setup(props) {\n    console.log(props.title_props);\n    console.log(props.node_props);\n    let title = ref(props.title_props);\n    let nodes = ref(props.node_props);\n    let lines = ref([]);\n    let count = 0;\n    let focus;\n    const LeaderLine = window.LeaderLine; // LeaderLine.positionByWindowResize = false\n\n    const right_append = (rap_node, node_text, node_childes, node_selector) => {\n      node_selector.appendChild(node_text);\n      rap_node.appendChild(node_selector);\n      rap_node.appendChild(node_childes);\n    };\n\n    const left_append = (rap_node, node_text, node_childes, node_selector) => {\n      node_selector.appendChild(node_text);\n      rap_node.appendChild(node_childes);\n      rap_node.appendChild(node_selector);\n    };\n\n    const makeFromParent = (node_text, rap_node, node_childes) => {\n      node_text.classList.add(\"p_nodes\");\n      rap_node.classList.add(\"rap_node\");\n      count++;\n      return {\n        rap_node,\n        node_text,\n        node_childes\n      };\n    };\n\n    const makeFromChild = (el, node_text, rap_node, node_childes, node_selector) => {\n      const margin_rap_node = document.createElement(\"div\");\n      margin_rap_node.classList.add(\"selector\");\n      const parent = document.getElementById(`${el[\"parent\"]}`);\n      node_text.classList.add(\"c_nodes\");\n      el.direction = nodes.value[el.parent].direction;\n\n      if (el.direction == 'right') {\n        right_append(rap_node, node_text, node_childes, node_selector);\n        rap_node.classList.add(\"rap_node\");\n      } else {\n        left_append(rap_node, node_text, node_childes, node_selector);\n        rap_node.classList.add(\"rap_node_left\");\n      }\n\n      margin_rap_node.appendChild(rap_node);\n      margin_rap_node.classList.add(\"margin_c_nodes\");\n      parent.appendChild(margin_rap_node);\n      return {\n        rap_node,\n        node_text,\n        node_childes\n      };\n    };\n\n    const makeline = (el, direction, parent) => {\n      direction;\n      let line = new LeaderLine(document.getElementById(parent), LeaderLine.pointAnchor(document.getElementById(`${\"node\" + el[\"id\"]}`), {\n        x: `${50 + \"%\"}`,\n        y: '50%'\n      })); // straight\n\n      line.path = \"magnet\";\n      line.endPlug = \"behind\";\n      const elmWrapper = document.getElementById('line-wrapper');\n      const el_line = document.querySelectorAll('.leader-line');\n\n      function position() {\n        elmWrapper.style.transform = 'none';\n        var rectWrapper = elmWrapper.getBoundingClientRect(); // Move to the origin of coordinates as the document\n\n        elmWrapper.style.transform = 'translate(' + (rectWrapper.left + pageXOffset) * -1 + 'px, ' + (rectWrapper.top + pageYOffset) * -1 + 'px)';\n        line.position();\n      }\n\n      elmWrapper.appendChild(el_line[el_line.length - 1]);\n      position();\n      lines.value.push(el_line[el_line.length - 1]);\n    };\n\n    const makelines = () => {\n      const right = 1;\n      const left = 99;\n      nodes.value.forEach(el => {\n        if (el.parent == 'title') {\n          if (el.direction == \"right\") {\n            makeline(el, right, 'title');\n          } else {\n            makeline(el, left, 'title');\n          }\n        } else {\n          if (el.direction == \"right\") {\n            makeline(el, right, `${\"node\" + el[\"parent\"]}`);\n          } else {\n            makeline(el, left, `${\"node\" + el[\"parent\"]}`);\n          }\n        }\n      });\n    };\n\n    const removelines = () => {\n      lines.value.forEach(el => {\n        el.parentNode.removeChild(el);\n      });\n      lines.value.length = 0;\n    };\n\n    const line_reset = () => {\n      removelines();\n      makelines();\n    };\n\n    const input_node = () => {\n      // console.log(\"dbclick_title_selector\")\n      // console.log(\"$event\", e.srcElement.id)\n      console.log(document.getElementById('title').id);\n      document.getElementById(\"title\").focus();\n      const el = document.getElementById('title');\n      const selection = window.getSelection();\n      const range = document.createRange();\n      selection.removeAllRanges();\n      range.selectNodeContents(el);\n      range.collapse(false);\n      selection.addRange(range);\n      el.focus();\n      return false;\n    };\n\n    const input_node_test = e => {\n      console.log('inputnode db', e);\n      console.log(document.getElementById(`node${e}`));\n      const target = document.getElementById(`node${e}`);\n      target.focus(); // const el = document.getElementById('title');\n\n      const selection = window.getSelection();\n      const range = document.createRange();\n      selection.removeAllRanges();\n      range.selectNodeContents(target);\n      range.collapse(false);\n      selection.addRange(range);\n      target.focus();\n      return false;\n    };\n\n    const update_focus = e => {\n      if (focus != null) {\n        focus.classList.remove(\"selector_focus\");\n      }\n\n      e.srcElement.classList.add(\"selector_focus\");\n      focus = null;\n      focus = e.srcElement;\n    };\n\n    const focus_node = () => {\n      // console.log(\"focusfocusfocus\",focus)\n      if (focus) {\n        focus.focus(); // childnodeの時ダブルクリックでフォーカスできるようにする\n      }\n    };\n\n    onMounted(() => {\n      console.log(\"mounted\");\n      const el_title = document.getElementById('title');\n      const el_edge = document.getElementById('edge');\n      const el_selector = document.getElementById('selector');\n      el_title.scrollIntoView({\n        block: 'center',\n        inline: 'center'\n      });\n      const right = document.getElementById(\"right_center\");\n      const left = document.getElementById(\"left_center\");\n      nodes.value.forEach(el => {\n        const node_text = document.createElement(\"div\");\n        const node_selector = document.createElement(\"div\");\n        node_selector.classList.add(\"selector\");\n        node_selector.id = `selector${el[\"id\"]}`;\n        node_selector.tabIndex = \"0\";\n        const rap_node = document.createElement(\"div\");\n        const node_childes = document.createElement(\"div\");\n        const text = document.createTextNode(el[\"text\"]);\n        node_text.contentEditable = true;\n        node_childes.id = `${el[\"id\"]}`;\n        node_text.id = `${\"node\" + el[\"id\"]}`;\n        node_text.appendChild(text);\n\n        if (el[\"parent\"] == 'title') {\n          console.log();\n\n          if (count % 2 == 0) {\n            let nodeFromParent = makeFromParent(node_text, rap_node, node_childes);\n            right_append(nodeFromParent.rap_node, nodeFromParent.node_text, nodeFromParent.node_childes, node_selector);\n            right.appendChild(nodeFromParent.rap_node);\n            el.direction = 'right';\n          } else {\n            let nodeFromParent = makeFromParent(node_text, rap_node, node_childes);\n            left_append(nodeFromParent.rap_node, nodeFromParent.node_text, nodeFromParent.node_childes, node_selector);\n            left.appendChild(nodeFromParent.rap_node);\n            node_childes.classList.add(\"margin-left\");\n            el.direction = 'left';\n          }\n        } else {\n          makeFromChild(el, node_text, rap_node, node_childes, node_selector);\n        } // 以下イベントの追加\n\n\n        const el_node = document.getElementById('node' + el.id);\n        const el_selector = document.getElementById('selector' + el.id);\n        el_node.addEventListener('blur', () => {\n          line_reset();\n        });\n        el_selector.addEventListener('click', e => {\n          update_focus(e);\n        });\n        el_selector.addEventListener('dblclick', e => {\n          input_node_test(e.srcElement.id.substr(8));\n        });\n        el_selector.addEventListener('keydown', e => {\n          if ((e.keyCode == 10 || e.keyCode == 13) && e.ctrlKey) {\n            console.log('keydown + ctrl');\n            input_node_test(e.srcElement.id.substr(8));\n          }\n        }); // 入力中はスクロールを解除する\n\n        el_node.addEventListener('focus', () => {\n          console.log(\"childnode\");\n          el_edge.removeEventListener('scroll', focus_node);\n        }); // 解除時のスクロールを戻す\n\n        el_node.addEventListener('blur', () => {\n          el_edge.addEventListener('scroll', focus_node);\n        });\n      });\n      console.log(nodes.value);\n      makelines(); // 親要素へのイベントの追加\n\n      el_selector.addEventListener('keydown', e => {\n        if ((e.keyCode == 10 || e.keyCode == 13) && e.ctrlKey) {\n          console.log('keydown + ctrl');\n          input_node(e);\n        }\n      });\n      el_edge.addEventListener('scroll', focus_node);\n      el_title.addEventListener('focus', () => {\n        console.log(\"focussss\");\n        el_edge.removeEventListener('scroll', focus_node);\n      });\n      el_title.addEventListener('blur', () => {\n        el_edge.addEventListener('scroll', focus_node);\n      });\n      console.log(el_selector);\n    });\n    return {\n      title,\n      nodes,\n      lines,\n      line_reset,\n      input_node,\n      update_focus,\n      focus_node\n    };\n  }\n\n};","map":{"version":3,"mappings":"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","names":["onMounted","ref","dragscroll","name","props","directives","setup","console","log","title_props","node_props","title","nodes","lines","count","focus","LeaderLine","window","right_append","rap_node","node_text","node_childes","node_selector","appendChild","left_append","makeFromParent","classList","add","makeFromChild","el","margin_rap_node","document","createElement","parent","getElementById","direction","value","makeline","line","pointAnchor","x","y","path","endPlug","elmWrapper","el_line","querySelectorAll","position","style","transform","rectWrapper","getBoundingClientRect","left","pageXOffset","top","pageYOffset","length","push","makelines","right","forEach","removelines","parentNode","removeChild","line_reset","input_node","id","selection","getSelection","range","createRange","removeAllRanges","selectNodeContents","collapse","addRange","input_node_test","e","target","update_focus","remove","srcElement","focus_node","el_title","el_edge","el_selector","scrollIntoView","block","inline","tabIndex","text","createTextNode","contentEditable","nodeFromParent","el_node","addEventListener","substr","keyCode","ctrlKey","removeEventListener"],"sourceRoot":"","sources":["C:\\Users\\tnazu\\OneDrive\\ドキュメント\\coding\\vue3\\mindmap\\src\\components\\MindMap.vue"],"sourcesContent":["<template>\n  <div class=\"edge\" id=\"edge\" v-dragscroll=\"true\">\n    <!-- @scroll=\"line_reset()\" -->\n    <div class=\"field\" id=\"field\">\n      <!-- <button class=\"btn\" @click=\"click()\">center</button> -->\n      <div class=\"left\">\n        <div class=\"left_vertical\">\n          <div class=\"left_horizontal\" id=\"left_center\">\n            <div></div>\n          </div>\n        </div>\n      </div>\n\n      <div class=\"center\">\n        <div class=\"title_node_rap\">\n          <!-- v-on:click=\"focus_node($event)\" -->\n\n\n          <!-- v-on:click.self=\"click_title_selector($event)\" -->\n\n          <div class=\"selector\" id=\"selector\" tabindex=\"0\"\n            v-on:click=\"update_focus($event)\"\n            v-on:dblclick=\"input_node($event)\">\n            <!-- @:keydown=\"keydown_title($event)\" -->\n\n            <div class=\"title_nodes\" id=\"title\" contenteditable=\"true\" @blur=\"line_reset()\">\n              <!-- @:keydown.tab=\"push_tab($el)\" -->\n              {{ title }}\n            </div>\n          </div>\n        </div>\n\n      </div>\n\n      <div class=\"right\">\n        <div class=\"right_vertical\">\n          <div class=\"right_horizontal\" id=\"right_center\">\n            <div></div>\n          </div>\n        </div>\n      </div>\n\n      <div id=\"line-wrapper\"></div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport {\n  onMounted,\n  ref,\n} from \"vue\"\nimport { dragscroll } from 'vue-dragscroll'\n\nexport default {\n  name: 'MindMap',\n  props: ['title_props', 'node_props'],\n  directives: {\n    dragscroll\n  },\n  setup(props) {\n    console.log(props.title_props)\n    console.log(props.node_props)\n\n    let title = ref(props.title_props)\n    let nodes = ref(props.node_props)\n    let lines = ref([\n\n    ])\n    let count = 0\n    let focus\n    const LeaderLine = window.LeaderLine;\n    // LeaderLine.positionByWindowResize = false\n\n    const right_append = (rap_node, node_text, node_childes, node_selector) => {\n      node_selector.appendChild(node_text)\n      rap_node.appendChild(node_selector)\n      rap_node.appendChild(node_childes)\n    }\n\n    const left_append = (rap_node, node_text, node_childes, node_selector) => {\n      node_selector.appendChild(node_text)\n      rap_node.appendChild(node_childes)\n      rap_node.appendChild(node_selector)\n    }\n\n    const makeFromParent = (node_text, rap_node, node_childes) => {\n      node_text.classList.add(\"p_nodes\");\n      rap_node.classList.add(\"rap_node\");\n\n      count++\n      return { rap_node, node_text, node_childes }\n    }\n\n    const makeFromChild = (el, node_text, rap_node, node_childes, node_selector) => {\n      const margin_rap_node = document.createElement(\"div\");\n      margin_rap_node.classList.add(\"selector\")\n\n      const parent = document.getElementById(`${el[\"parent\"]}`)\n      node_text.classList.add(\"c_nodes\");\n\n      el.direction = nodes.value[el.parent].direction\n      if (el.direction == 'right') {\n        right_append(rap_node, node_text, node_childes, node_selector)\n        rap_node.classList.add(\"rap_node\");\n      } else {\n        left_append(rap_node, node_text, node_childes, node_selector)\n        rap_node.classList.add(\"rap_node_left\");\n      }\n\n      margin_rap_node.appendChild(rap_node)\n      margin_rap_node.classList.add(\"margin_c_nodes\");\n      parent.appendChild(margin_rap_node)\n      return { rap_node, node_text, node_childes }\n    }\n\n    const makeline = (el, direction, parent) => {\n      direction\n      let line = new LeaderLine(\n        document.getElementById(parent),\n        LeaderLine.pointAnchor(document.getElementById(`${\"node\" + el[\"id\"]}`), { x: `${50 + \"%\"}`, y: '50%' })\n      );\n      // straight\n      line.path = \"magnet\"\n      line.endPlug = \"behind\"\n\n      const elmWrapper = document.getElementById('line-wrapper');\n      const el_line = document.querySelectorAll('.leader-line')\n\n      function position() {\n        elmWrapper.style.transform = 'none';\n        var rectWrapper = elmWrapper.getBoundingClientRect();\n        // Move to the origin of coordinates as the document\n        elmWrapper.style.transform = 'translate(' +\n          ((rectWrapper.left + pageXOffset) * -1) + 'px, ' +\n          ((rectWrapper.top + pageYOffset) * -1) + 'px)';\n        line.position();\n      }\n      elmWrapper.appendChild(el_line[el_line.length - 1]);\n      position()\n      lines.value.push(el_line[el_line.length - 1])\n    }\n\n    const makelines = () => {\n      const right = 1\n      const left = 99\n\n      nodes.value.forEach(el => {\n        if (el.parent == 'title') {\n          if (el.direction == \"right\") {\n            makeline(el, right, 'title')\n          } else {\n            makeline(el, left, 'title')\n          }\n        } else {\n          if (el.direction == \"right\") {\n            makeline(el, right, `${\"node\" + el[\"parent\"]}`)\n          } else {\n            makeline(el, left, `${\"node\" + el[\"parent\"]}`)\n          }\n\n        }\n      })\n    }\n\n    const removelines = () => {\n      lines.value.forEach(el => {\n        el.parentNode.removeChild(el)\n      })\n      lines.value.length = 0\n    }\n\n    const line_reset = () => {\n      removelines()\n      makelines()\n    }\n\n\n\n    const input_node = () => {\n      // console.log(\"dbclick_title_selector\")\n      // console.log(\"$event\", e.srcElement.id)\n      console.log(document.getElementById('title').id)\n      document.getElementById(\"title\").focus();\n      const el = document.getElementById('title');\n      const selection = window.getSelection();\n      const range = document.createRange();\n      selection.removeAllRanges();\n      range.selectNodeContents(el);\n      range.collapse(false);\n      selection.addRange(range);\n      el.focus();\n      return false;\n    }\n\n    const input_node_test = (e) => {\n      console.log('inputnode db', e)\n      console.log(document.getElementById(`node${e}`))\n\n      const target = document.getElementById(`node${e}`)\n\n      target.focus();\n      // const el = document.getElementById('title');\n      const selection = window.getSelection();\n      const range = document.createRange();\n      selection.removeAllRanges();\n      range.selectNodeContents(target);\n      range.collapse(false);\n      selection.addRange(range);\n      target.focus();\n      return false;\n    }\n\n\n    const update_focus = (e) => {\n      if (focus != null) {\n        focus.classList.remove(\"selector_focus\");\n      }\n      e.srcElement.classList.add(\"selector_focus\");\n      focus = null\n      focus = e.srcElement\n    }\n\n\n    const focus_node = () => {\n      // console.log(\"focusfocusfocus\",focus)\n      if (focus) {\n        focus.focus()\n        // childnodeの時ダブルクリックでフォーカスできるようにする\n      }\n    }\n\n    onMounted(() => {\n      console.log(\"mounted\")\n\n      const el_title = document.getElementById('title')\n      const el_edge = document.getElementById('edge')\n      const el_selector = document.getElementById('selector')\n\n      el_title.scrollIntoView({ block: 'center', inline: 'center', })\n\n      const right = document.getElementById(\"right_center\");\n      const left = document.getElementById(\"left_center\");\n\n      nodes.value.forEach(el => {\n        const node_text = document.createElement(\"div\");\n\n        const node_selector = document.createElement(\"div\");\n        node_selector.classList.add(\"selector\")\n        node_selector.id = `selector${el[\"id\"]}`\n        node_selector.tabIndex = \"0\";\n\n        const rap_node = document.createElement(\"div\");\n        const node_childes = document.createElement(\"div\");\n        const text = document.createTextNode(el[\"text\"]);\n        node_text.contentEditable = true;\n\n        node_childes.id = `${el[\"id\"]}`\n        node_text.id = `${\"node\" + el[\"id\"]}`\n        node_text.appendChild(text)\n\n        if (el[\"parent\"] == 'title') {\n          console.log()\n          if (count % 2 == 0) {\n            let nodeFromParent = makeFromParent(node_text, rap_node, node_childes)\n            right_append(nodeFromParent.rap_node, nodeFromParent.node_text, nodeFromParent.node_childes, node_selector)\n            right.appendChild(nodeFromParent.rap_node)\n            el.direction = 'right'\n          } else {\n            let nodeFromParent = makeFromParent(node_text, rap_node, node_childes)\n            left_append(nodeFromParent.rap_node, nodeFromParent.node_text, nodeFromParent.node_childes, node_selector)\n            left.appendChild(nodeFromParent.rap_node)\n            node_childes.classList.add(\"margin-left\")\n            el.direction = 'left'\n          }\n        } else {\n          makeFromChild(el, node_text, rap_node, node_childes, node_selector)\n        }\n\n        // 以下イベントの追加\n        const el_node = document.getElementById('node' + el.id)\n        const el_selector = document.getElementById('selector' + el.id)\n\n        el_node.addEventListener('blur', () => {\n          line_reset()\n        });\n\n        el_selector.addEventListener('click', (e) => {\n          update_focus(e)\n        });\n\n        el_selector.addEventListener('dblclick', (e) => {\n          input_node_test(e.srcElement.id.substr(8))\n        })\n\n        el_selector.addEventListener('keydown', (e) => {\n          if ((e.keyCode == 10 || e.keyCode == 13) && e.ctrlKey) {\n            console.log('keydown + ctrl')\n            input_node_test(e.srcElement.id.substr(8))\n          }\n        })\n\n        // 入力中はスクロールを解除する\n        el_node.addEventListener('focus', () => {\n          console.log(\"childnode\")\n          el_edge.removeEventListener('scroll',\n            focus_node\n          )\n        })\n\n        // 解除時のスクロールを戻す\n        el_node.addEventListener('blur', () => {\n          el_edge.addEventListener('scroll', focus_node)\n        })\n\n      });\n\n\n      console.log(nodes.value)\n      makelines()\n\n      // 親要素へのイベントの追加\n      el_selector.addEventListener('keydown', (e) => {\n        if ((e.keyCode == 10 || e.keyCode == 13) && e.ctrlKey) {\n          console.log('keydown + ctrl')\n          input_node(e)\n        }\n      })\n\n      el_edge.addEventListener('scroll', focus_node)\n\n      el_title.addEventListener('focus', () => {\n        console.log(\"focussss\")\n        el_edge.removeEventListener('scroll', focus_node)\n      })\n\n      el_title.addEventListener('blur', () => {\n        el_edge.addEventListener('scroll', focus_node)\n      })\n\n      console.log(el_selector)\n\n\n\n    });\n\n    return {\n      title,\n      nodes,\n      lines,\n      line_reset,\n      input_node,\n      update_focus,\n      focus_node,\n    };\n\n  },\n}\n</script>\n\n<!-- Add \"scoped\" attribute to limit CSS to this component only -->\n<style>\n#line-wrapper {\n  z-index: -100;\n}\n\n.btn {\n  z-index: 10000;\n  /* display: flex; */\n}\n\n.edge {\n  width: 100vh;\n  height: 100vh;\n  overflow: hidden;\n  /* border: 1px solid #000; */\n}\n\n.field {\n  width: 5000px;\n  height: 5000px;\n  z-index: 1;\n  display: flex;\n  position: relative;\n}\n\n.center {\n  width: 10%;\n  height: 100%;\n  /* z-index: 1; */\n  /* background-color: coral; */\n}\n\n.right {\n  width: 45%;\n  height: 100%;\n  display: flex;\n  align-items: center;\n}\n\n.right_vertical {\n  width: 100%;\n  /* background-color: olive; */\n  margin: 0 auto;\n  display: flex;\n  justify-content: flex-start;\n}\n\n.right_horizontal {\n  width: fit-content;\n  /* background-color: orchid; */\n}\n\n.left {\n  width: 45%;\n  height: 100%;\n  display: flex;\n  align-items: center;\n}\n\n.left_vertical {\n  width: 100%;\n  margin: 0 auto;\n  text-align: left;\n  display: flex;\n  justify-content: flex-end;\n  /* background-color: olive; */\n}\n\n.left_horizontal {\n  width: fit-content;\n  /* background-color: orchid; */\n}\n\n.title_node_rap {\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  width: 100%;\n  height: 100%;\n  z-index: 2;\n}\n\n.selector {\n  width: fit-content;\n  height: fit-content;\n  border-radius: 10px;\n  /* background-color:#00aaff; */\n  position: relative;\n}\n\n.selector:focus {\n  outline: none;\n}\n\n.title_selector:focus {\n  outline: none;\n}\n\n.title_nodes {\n  background-color: white;\n  border-radius: 10px;\n  /* box-shadow: 0 3px 3px 0 rgba(0, 0, 0, .5); */\n\n  width: fit-content;\n\n  font-size: 35px;\n  font-family: sans-serif;\n  padding: 10px 10px;\n  max-width: 200px;\n\n  /* pointer-events: none; */\n  position: relative;\n  z-index: -10;\n}\n\n.title_nodes:focus {\n  outline: none;\n}\n\n.p_nodes {\n  background-color: #F5F5F5;\n  border-radius: 10px;\n  box-shadow: 0 3px 3px 0 rgba(0, 0, 0, .5);\n  /* width: fit-content;\n  height: fit-content; */\n  width: -moz-fit-content;\n  /* Firefox */\n  width: fit-content;\n  /* other browsers */\n  font-size: 23px;\n  font-family: sans-serif;\n  padding: 10px 10px;\n  margin: auto 0;\n\n  position: relative;\n  z-index: -10;\n}\n\n.p_nodes:focus {\n  outline: none;\n}\n\n.c_nodes {\n  background-color: #F5F5F5;\n  border-radius: 10px;\n  box-shadow: 0 3px 3px 0 rgba(0, 0, 0, .5);\n  /* width: fit-content;\n  height: fit-content; */\n\n  width: -moz-fit-content;\n  width: fit-content;\n\n  font-size: 23px;\n  font-family: sans-serif;\n\n  padding: 10px 10px;\n  /* margin: 30px 30px; */\n\n  position: relative;\n  z-index: -10;\n}\n\n.c_nodes:focus {\n  outline: none;\n}\n\n.margin_c_nodes{\n  margin: 30px 30px;\n}\n\n.rap_node {\n  display: flex;\n  align-items: center;\n  width: 100%;\n  /* height: 100%; */\n  /* padding: 10px 0px; */\n  /* margin-left: auto;\n  margin-right: 0; */\n\n  /* background-color: aqua; */\n}\n\n.rap_node_left {\n  display: flex;\n  align-items: center;\n  padding: 10px 0px;\n  width: 100%;\n\n  justify-content: flex-end;\n}\n\n.margin-left {\n  /* margin: auto; */\n  margin-left: auto;\n  margin-right: 0;\n}\n\n.selector_focus {\n  border: 4px solid #00aaff;\n  border-radius: 10px;\n}\n</style>"]},"metadata":{},"sourceType":"module"}